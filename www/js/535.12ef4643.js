"use strict";(self["webpackChunkreporter"]=self["webpackChunkreporter"]||[]).push([[535],{61535:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var o=i(83673),n=i(62323);const s={key:0,class:"absolute-bottom-right q-ma-md"},r={class:"row text-center"},l=(0,o._)("div",{class:"col-12 absolute-top alert-header"},[(0,o._)("h4",null,"Envoyer une alerte")],-1),a={class:"col-12 absolute-center"},d={class:"col-12 absolute-bottom alert-bottom"},c=(0,o._)("div",{class:"alert-label"},"Annuler",-1);function u(e,t,i,u,p,m){const h=(0,o.up)("parents-categories"),g=(0,o.up)("q-icon"),w=(0,o.up)("q-btn"),v=(0,o.up)("big"),y=(0,o.up)("q-layout"),b=(0,o.up)("q-dialog"),k=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(k,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{onGoNext:m.goNext},null,8,["onGoNext"]),m.hasRecipients?((0,o.wg)(),(0,o.iD)("div",s,[(0,o.Wm)(w,{round:"",color:"negative",onClick:m.initALert},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{name:"warning"})])),_:1},8,["onClick"])])):(0,o.kq)("",!0),(0,o.Wm)(b,{maximized:"",modelValue:p.alertModalOpened,"onUpdate:modelValue":t[0]||(t[0]=e=>p.alertModalOpened=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{class:"alert-modal"},{default:(0,o.w5)((()=>[(0,o._)("div",r,[l,(0,o._)("div",a,[(0,o.Wm)(w,{round:"",color:"negative",size:"50px"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(p.secondsRemaining),1)])),_:1})])),_:1})]),(0,o._)("div",d,[(0,o.Wm)(w,{size:"22px",icon:"clear",outline:"",round:"",onClick:m.dismissAlert},null,8,["onClick"]),c])])])),_:1})])),_:1},8,["modelValue"])])),_:1})}i(92100);const p={key:0,class:"row q-py-md"},m=["src"],h=["onClick"],g={key:1,class:"row q-py-md"},w=["src"],v=["onClick"];function y(e,t,i,s,r,l){const a=(0,o.up)("q-btn");return e.categories.length>4?((0,o.wg)(),(0,o.iD)("div",p,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.categories,(t=>((0,o.wg)(),(0,o.iD)("div",{class:"col-6 q-py-md text-center",key:`topcat-${t.id}`},[(0,o.Wm)(a,{round:"",color:"primary",size:"20px",onClick:i=>e.$emit("goNext",t.id)},{default:(0,o.w5)((()=>[(0,o._)("img",{src:t.img,style:{"max-height":"30px"}},null,8,m)])),_:2},1032,["onClick"]),(0,o._)("div",{class:"text-subtitle2 q-pt-sm",onClick:i=>e.$emit("goNext",t.id)},(0,n.zw)(t.name),9,h)])))),128))])):((0,o.wg)(),(0,o.iD)("div",g,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.categories,(t=>((0,o.wg)(),(0,o.iD)("div",{class:"col-12 q-py-lg q-pl-md",key:`topcat-${t.id}`},[(0,o.Wm)(a,{round:"",color:"primary",size:"22px",onClick:i=>e.$emit("goNext",t.id)},{default:(0,o.w5)((()=>[(0,o._)("img",{src:t.img,style:{"max-height":"40px"}},null,8,w)])),_:2},1032,["onClick"]),(0,o._)("span",{class:"text-h6 text-weight-regular q-pl-sm",onClick:i=>e.$emit("goNext",t.id)},(0,n.zw)(t.name),9,v)])))),128))]))}var b=i(93617);const k={mounted(){},data(){return{}},methods:{},computed:{...(0,b.Se)({categories:"company/categories"})}};var x=i(74260),q=i(48240),A=i(7518),_=i.n(A);const f=(0,x.Z)(k,[["render",y]]),C=f;_()(k,"components",{QBtn:q.Z});var D=i(38400),$=i(85615),N=i(40019);const{setScrollPosition:P}=D.ZP,W={components:{ParentsCategories:C},async mounted(){window.addEventListener("deviceready",this.setGeolocation(),!1),this.geoId=await $.b.watchPosition({},((e,t)=>{this.position=e,t.code!==error.PERMISSION_DENIED&&window.setTimeout((function(){this.setGeolocation()}),5e3)})),this.$q.loading.hide()},beforeDestroy(){$.b.clearWatch(this.geoId)},data(){return{alertModalOpened:!1,secondsRemaining:5,intervalHandle:null,position:{},isPositionKnown:!1,alertError:{title:"Erreur d'envoi",message:"Suite à un problème réseau, votre alerte n'a pas été envoyée."},geoId:null}},computed:{...(0,b.Se)({reporter:"reporter/attributes"}),hasRecipients(){return this.reporter&&"recipients"in this.reporter&&Array.isArray(this.reporter.recipients)&&this.reporter.recipients.length}},methods:{async setGeolocation(){if(this.hasRecipients){const e=await $.b.getCurrentPosition({enableHighAccuracy:!0,timeout:5e3,maximumAge:0});this.position=e,N.log("this.position",JSON.stringify(this.position))}},goNext(e){this.$router.push({path:"/categories/"+e+"/childs"})},initALert(){this.setGeolocation(),this.alertModalOpened=!0,window.clearInterval(this.intervalHandle),this.countdown(5).then((()=>this.sendAlert()))},initAlertDetails(){this.$q.dialog({title:"Précisions :",prompt:{type:"textarea",label:"Votre message ...",model:""},ok:"Envoyer",cancel:"Annuler"}).onOk((e=>this.sendAlertDetails(e))).onCancel((()=>P(window,window.document.body.scrollHeight)))},dismissAlert(){this.alertModalOpened=!1,clearInterval(this.intervalHandle)},sendAlert(){this.dismissAlert();let e="";this.isPositionKnown&&(e=this.position.coords.longitude+","+this.position.coords.latitude),this.$store.dispatch("reporter/sendAlert",{lonlat:e,message:""}).then((()=>this.initAlertDetails()),(()=>this.$q.dialog(this.alertError)))},sendAlertDetails(e){this.$store.dispatch("reporter/sendAlert",{lonlat:"",message:e}).then((()=>P(window,window.document.body.scrollHeight)),(()=>{this.$q.dialog(this.alertError),P(window,window.document.body.scrollHeight)}))},countdown(e){return new Promise(((t,i)=>{this.secondsRemaining=e,this.intervalHandle=setInterval((()=>{1===this.secondsRemaining&&t(),this.secondsRemaining--}),1e3)}))}}};var E=i(24379),H=i(24554),I=i(24390),R=i(19214);const Z=(0,x.Z)(W,[["render",u]]),z=Z;_()(W,"components",{QPage:E.Z,QBtn:q.Z,QIcon:H.Z,QDialog:I.Z,QLayout:R.Z})}}]);