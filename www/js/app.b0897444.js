(()=>{var __webpack_modules__={65937:(e,t,s)=>{"use strict";s(65363),s(10071);var r=s(98880),o=s(99592),a=s(83673);const i={id:"q-app"};function n(e,t,s,r,o,n){const l=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(l)])}var l=s(86310);const c={inject:["$DB","$cron"],created(){this.$DB.initLocal(this.$q.platform.is.capacitor),l.Z.$on("processQueue",this.processQueue),l.Z.$on("pauseQueue",this.pauseQueue),l.Z.$on("userConnected",this.startSync),l.Z.$on("localIssueChange",this.loadNotifications),this.$q.platform.is.capacitor&&(document.addEventListener("deviceready",this.initOneSignal,!1),this.$cron.start("getAppUpdatesJob"),this.$SowellProxy.isOnMobile=!0),document.addEventListener("online",(e=>{this.startSync()}),!1)},watch:{"$q.appVisible"(e,t){e&&this.startSync()}},data(){return{job:null,notificationsLoading:!1}},computed:{},methods:{processQueue(){this.$cron.start("syncTmpItemsJob")},pauseQueue(){this.$cron.stop("syncTmpItemsJob")},async startSync(){var e=this.$store.getters["reporter/token"];e.length&&this.$helpers.isTokenValid(e).then((()=>{this.watchLocalIssuesConflicts(),this.$DB.initDBSync(this.$store.getters["company/attributes"],this.$store.getters["reporter/attributes"]),this.$store.dispatch("audits/load"),this.loadNotifications(),l.Z.$emit("processQueue")}))},async watchLocalIssuesConflicts(){var e=this;e.$DB.localIssues().changes({since:"now",live:!0,include_docs:!0}).on("change",(t=>{"deleted"in t&&!1!==t.deleted||(e.$DB.localIssues().get(t.doc._id,{conflicts:!0}).then((s=>{if("_conflicts"in s){let r=t.doc.meta.updatedAt;for(let o of s._conflicts)e.$DB.localIssues().get(t.doc._id,{rev:o}).then((s=>{new Date(r)>new Date(s.meta.updatedAt)?e.$DB.localIssues().remove(t.doc._id,o):e.$DB.localIssues().remove(t.doc._id,t.doc.rev)}))}})),l.Z.$emit("localIssueChange",t))}))},loadNotifications(){this.notificationsLoading||(this.notificationsLoading=!0,this.$SowellProxy.loadReporterNotifications().then((e=>{this.$store.dispatch("reporter/setNotifications",e.data.notifications),this.$SowellProxy.clearReporterNotifications().then((()=>{this.notificationsLoading=!1,this.$q.platform.is.capacitor&&this.$q.appVisible&&window.plugins.OneSignal.clearOneSignalNotifications()}),(()=>{this.notificationsLoading=!1,this.$q.platform.is.capacitor&&this.$q.appVisible&&window.plugins.OneSignal.clearOneSignalNotifications()}))}),(()=>{this.notificationsLoading=!1,this.$q.platform.is.capacitor&&this.$q.appVisible&&window.plugins.OneSignal.clearOneSignalNotifications()})))},initOneSignal(){window.plugins.OneSignal.startInit("3f6a1f2d-be99-48ff-b70f-17bfc70e4cc3").inFocusDisplaying(window.plugins.OneSignal.OSInFocusDisplayOption.None).handleNotificationReceived((e=>{this.$store.getters["reporter/token"].length&&this.$helpers.isTokenValid(this.$store.getters["reporter/token"]).then((()=>{if(this.loadNotifications(),"additionalData"in e.payload&&"type"in e.payload.additionalData){let t=e.payload.additionalData;switch(t.type){case"issue_status_changed":this.$q.notify({type:"info",position:"top",detail:"La demande #"+t.issue+" a changé de statut",message:"La demande #"+t.issue+" a changé de statut",actions:[{label:"Voir",icon:"open_in_new",handler:()=>{"issueDetail"===this.$route.name||"issuesList"===this.$route.name?l.Z.$emit("openModal",t.issue):this.$router.push({path:"/history/"+t.issue})}}]});break;case"issue_talk_added":this.$q.dialog({title:"Nouveau message",message:"La demande #"+t.issue+" a un nouveau message",color:"primary",stackButtons:!0,ok:"Voir",cancel:"Plus tard"}).onOk((()=>{"issueDetail"===this.$route.name||"issuesList"===this.$route.name?l.Z.$emit("openModal",t.issue):this.$router.push({path:"/history/"+t.issue})})).catch((()=>{}));break;case"issue_created":this.$q.dialog({title:"Nouveau message",message:"La demande #"+t.issue+" vient d'être ajoutée sur votre secteur",color:"primary",stackButtons:!0,ok:"Voir",cancel:"Plus tard"}).onOk((()=>{"issueDetail"===this.$route.name||"issuesList"===this.$route.name?l.Z.$emit("openModal",t.issue):this.$router.push({path:"/history/"+t.issue})})).catch((()=>{}));break;default:this.$q.notify({type:"info",position:"top",detail:t.type,message:"Information de SoWell"})}}else this.$q.notify({type:"info",position:"top",detail:e.payload.body,message:e.payload.title})}))})).handleNotificationOpened((e=>{let t=e.notification.payload.additionalData;this.$store.getters["reporter/token"].length&&this.$helpers.isTokenValid(this.$store.getters["reporter/token"]).then((()=>{!("type"in t)||"issue_status_changed"!==t.type&&"issue_talk_added"!==t.type&&"issue_created"!==t.type||this.$router.push({path:"/history/"+t.issue})}))})).endInit()}}};var p=s(74260);const d=(0,p.Z)(c,[["render",n]]),u=d;var h=s(69698),m=s(47083),g=s(79582);const _=[{name:"home",path:"/",redirect:{path:"/login"},component:()=>Promise.all([s.e(736),s.e(64),s.e(129)]).then(s.bind(s,81411)),children:[{path:"categories",component:()=>Promise.all([s.e(736),s.e(535)]).then(s.bind(s,61535))},{path:"zones",component:()=>Promise.all([s.e(736),s.e(34)]).then(s.bind(s,72034))},{path:"history",component:()=>Promise.all([s.e(736),s.e(131)]).then(s.bind(s,60131))}]},{name:"login",path:"/login",component:()=>Promise.all([s.e(736),s.e(302)]).then(s.bind(s,96302)),children:[{path:"",component:()=>Promise.all([s.e(736),s.e(265)]).then(s.bind(s,13265)),name:"Login"}]},{name:"ResetPassword",path:"/ResetPassword",component:()=>Promise.all([s.e(736),s.e(302)]).then(s.bind(s,96302)),props:e=>({query:e.query.key}),children:[{path:"/",component:()=>Promise.all([s.e(736),s.e(72)]).then(s.bind(s,90072)),name:"ResetPassword"}]},{name:"categories",path:"/categories",component:()=>Promise.all([s.e(736),s.e(64),s.e(666)]).then(s.bind(s,47739)),children:[{path:":id/childs",component:()=>Promise.all([s.e(736),s.e(354)]).then(s.bind(s,69354)),name:"subcategories"},{path:":id/issue",component:()=>Promise.all([s.e(736),s.e(64),s.e(677)]).then(s.bind(s,38751))}]},{name:"zones",path:"/zones",component:()=>Promise.all([s.e(736),s.e(533)]).then(s.bind(s,32533)),children:[{path:":id",component:()=>Promise.all([s.e(736),s.e(70)]).then(s.bind(s,6070))},{path:":zoneId/places/:placeId",component:()=>Promise.all([s.e(736),s.e(395)]).then(s.bind(s,71395))},{path:":zoneId/places/:placeId/audits/:auditId",component:()=>Promise.all([s.e(736),s.e(246)]).then(s.bind(s,61246)),name:"newReport"},{path:":zoneId/places/:placeId/audits/:auditId/issue",component:()=>Promise.all([s.e(736),s.e(64),s.e(341)]).then(s.bind(s,35617)),name:"newIssue"}]},{name:"issuesList",path:"/history",component:()=>Promise.all([s.e(736),s.e(64),s.e(129)]).then(s.bind(s,81411)),children:[{name:"issueDetail",path:":id",component:()=>Promise.all([s.e(736),s.e(131)]).then(s.bind(s,60131))}]},{path:"/:catchAll(.*)*",redirect:"/categories"}];const f=_;s(76237);const w=(0,m.BC)((function(){const e=g.r5,t=(0,g.p7)({scrollBehavior:()=>({y:0}),routes:f,mode:"hash",base:"",history:e("")});return t}));async function b(e,t){const r="function"===typeof h["default"]?await(0,h["default"])({}):h["default"],{storeKey:a}=await Promise.resolve().then(s.bind(s,69698)),i="function"===typeof w?await w({store:r}):w;r.$router=i;const n=e(u);return n.use(o.Z,t),{app:n,store:r,storeKey:a,router:i}}var y=s(87760),k=s(72448),P=s(19214),j=s(53812),v=s(41762),S=s(72652),E=s(24379),A=s(39570),I=s(13747),T=s(57547),O=s(58408),$=s(5906),R=s(86602),C=s(51598),D=s(47704),N=s(34765),q=s(6833),L=s(42770),z=s(27011),x=s(83414),U=s(52035),Z=s(2350),B=s(67030),M=s(86115),Q=s(34842),H=s(48240),F=s(24554),V=s(5363),J=s(62064),G=s(65735),W=s(40629),K=s(24390),Y=s(74484),X=s(10151),ee=s(62025),te=s(25589),se=s(99367),re=s(18506),oe=s(24264),ae=s(84710),ie=s(20811),ne=s(65869),le=s(31277),ce=s(34593),pe=s(69721),de=s(46489),ue=s(87281),he=s(60677),me=s(6579),ge=s(64434),_e=s(16249),fe=s(56395),we=s(30584),be=s(82139);const ye={config:{capacitor:{backButtonExit:["/login"]}},iconSet:y.Z,components:{QSelect:k.Z,QLayout:P.Z,QHeader:j.Z,QFooter:v.Z,QPageContainer:S.Z,QPage:E.Z,QToolbar:A.Z,QToolbarTitle:I.Z,QTabs:T.Z,QTab:O.Z,QTabPanels:$.Z,QTabPanel:R.Z,QLinearProgress:C.Z,QScrollArea:D.Z,QSpinnerDots:N.Z,QSpinner:q.Z,QRouteTab:L.Z,QList:z.Z,QItem:x.Z,QItemSection:U.Z,QItemLabel:Z.Z,QChip:B.Z,QField:M.Z,QInput:Q.Z,QBtn:H.Z,QIcon:F.Z,QTooltip:V.Z,QSlider:J.Z,QCheckbox:G.Z,QChatMessage:W.Z,QDialog:K.Z,QTable:Y.Z,QCard:X.Z,QSpace:ee.Z,QCardSection:te.Z,QCardActions:se.Z,QSpinnerIos:re.Z,QPageSticky:oe.Z,QPageScroller:ae.Z,QMenu:ie.Z,QSeparator:ne.Z,QCarousel:le.Z,QCarouselSlide:ce.Z,QBadge:pe.Z},directives:{Ripple:de.Z,TouchHold:ue.Z,ClosePopup:he.Z},plugins:{Dialog:me.Z,Notify:ge.Z,Loading:_e.Z,LocalStorage:fe.Z,AppVisibility:we.Z,BottomSheet:be.Z}};var ke=s(40019);const Pe="";async function je({app:e,router:t,store:s,storeKey:r},o){let a=!1;const i=e=>{try{return t.resolve(e).href}catch(s){}return Object(e)===e?null:e},n=e=>{if(a=!0,"string"===typeof e&&/^https?:\/\//.test(e))return void(window.location.href=e);const t=i(e);null!==t&&(window.location.href=t,window.location.reload())},l=window.location.href.replace(window.location.origin,"");for(let p=0;!1===a&&p<o.length;p++)try{await o[p]({app:e,router:t,store:s,ssrContext:null,redirect:n,urlPath:l,publicPath:Pe})}catch(c){return c&&c.url?void n(c.url):void ke.error("[Quasar] boot error:",c)}!0!==a&&(e.use(t),e.use(s,r),e.mount("#q-app"))}b(r.ri,ye).then((e=>Promise.all([Promise.resolve().then(s.bind(s,34312)),Promise.resolve().then(s.bind(s,76237)),Promise.resolve().then(s.bind(s,29274)),Promise.resolve().then(s.bind(s,16862)),Promise.resolve().then(s.bind(s,35314)),Promise.resolve().then(s.bind(s,65768)),Promise.resolve().then(s.bind(s,90626))]).then((t=>{const s=t.map((e=>e.default)).filter((e=>"function"===typeof e));je(e,s)}))))},35314:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var quasar_wrappers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(47083);const CronJob=__webpack_require__(57858).CronJob,__WEBPACK_DEFAULT_EXPORT__=(0,quasar_wrappers__WEBPACK_IMPORTED_MODULE_0__.xr)((({app,store})=>{const syncStatus=e=>{switch(e){case SyncStatus.DOWNLOADING_PACKAGE:app.config.globalProperties.$q.notify({message:"Une mise à jour est disponible, elle sera installée automatiquement",type:"info",position:"top"});break;case SyncStatus.UPDATE_INSTALLED:syncApp(!0);break;case SyncStatus.ERROR:store.getters["common/appRestartRequired"]&&(app.config.globalProperties.$q.notify({message:"Une mise à jour est disponible mais ne peut être installée",type:"warning",position:"top"}),store.dispatch("common/setAppRequiresRestart",!1));break}},syncApp=e=>{e&&(store.dispatch("common/setAppRequiresRestart",!0),restartAppJob.start()),"newIssue"!==store.$router.history.current.name&&"newReport"!==store.$router.history.current.name&&(store.dispatch("common/setAppRequiresRestart",!1),alert("Une mise à jour a été installée, l'application SoWell va redémarrer ..."))},syncTmpItemsJob=new CronJob({cronTime:"*/10 * * * * *",onTick:()=>{app.config.globalProperties.$DB.syncTmpItems(store,store._vm.$SowellProxy)},onComplete:null,start:null,timezone:null,context:null,runOnInit:!1}),getAppUpdatesJob=new CronJob({cronTime:"* */5 * * * *",onTick:()=>{},onComplete:null,start:null,timezone:null,context:null,runOnInit:!1}),restartAppJob=new CronJob({cronTime:"*/10 * * * * *",onTick:()=>{store.getters["common/appRestartRequired"]&&syncApp(!1)},onComplete:null,start:null,timezone:null,context:null,runOnInit:!1}),cron={start:jobName=>{eval(jobName).stop(),eval(jobName).start(),eval(jobName).fireOnTick()},stop:jobName=>{eval(jobName).stop()}};app.config.globalProperties.$cron=cron,app.provide("$cron",cron)}))},29274:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});s(65363),s(92100);var r=s(47083);const o=(0,r.xr)((({app:e})=>{const t={process:(e,s)=>new Promise(((r,o)=>{s.hasOwnProperty("response")?void 0===s.response?r(t.throwNoNetwork(e,s)):401===s.response.status?r(t.throwNoSession(e,s)):404===s.response.status?r(t.throwBadCredentials(e,s)):r(t.throwUnmanaged(e,s)):s.hasOwnProperty("data")?"Unauthorized"===s.data.title?r(t.throwNoSession(e,s)):"Not Found"===s.data.title?r(t.throwNotFound(e,s)):r(t.throwUnmanaged(e,s)):s.hasOwnProperty("0")&&s[0].hasOwnProperty("title")?s[0]["title"].startsWith("duplicate detected")?r(t.suppressErrors(s)):"Resource not found"==s[0]["title"]?r(t.throwNonExistingElement(s)):r(t.throwJsonApiErrors(e,s)):r(t.throwUnproceseable(e,s))})),throwUnmanaged:(t,s)=>(e.config.globalProperties.$q.loading.hide(),e.config.globalProperties.$q.notify({message:"Une erreur non gerée s'est produite",type:"warning",position:"top"}),e.router.replace({path:"/login"}),s),throwNotFound:(t,s)=>(e.config.globalProperties.$q.loading.hide(),s),throwUnproceseable:(t,s)=>{e.config.globalProperties.$q.loading.hide();let r="Une erreur s'est produite pendant l'enregistrement";return t.length&&(r=t),e.config.globalProperties.$q.notify({message:r,type:"warning",position:"top"}),s},throwJsonApiErrors:(t,s)=>{e.config.globalProperties.$q.loading.hide();let r="Une erreur s'est produite pendant l'enregistrement";return t.length&&(r=t+" detail : \r\n"+JSON.stringify(s)),e.config.globalProperties.$q.notify({message:r,type:"warning",position:"top"}),s},throwNoSession:(t,s)=>(e.config.globalProperties.$q.loading.hide(),e.config.globalProperties.$q.notify({message:"Votre session a expiré, merci de vous reconnecter",type:"warning",position:"top"}),s),throwBadCredentials:(t,s)=>(e.config.globalProperties.$q.loading.hide(),e.config.globalProperties.$q.notify({message:"Les identifiants fournis sont incorrects",type:"warning",position:"top"}),s),throwNoNetwork:(t,s)=>(e.config.globalProperties.$q.loading.hide(),e.config.globalProperties.$q.notify({message:"Impossible de joindre le serveur, veuillez vérifier votre accès à internet",type:"warning",position:"top"}),s),throwNonExistingElement:t=>(e.config.globalProperties.$q.loading.hide(),e.config.globalProperties.$q.notify({message:"Une erreur est survenue, veuillez vous reconnecter en cochant la case réinitialiser. Si le problème persiste, veuillez contacter votre responsable",type:"warning",position:"top",timeout:6e3}),t),suppressErrors:t=>(e.config.globalProperties.$q.loading.hide(),t)};e.config.globalProperties.$ErrorHandler=t}))},76237:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p,helpers:()=>c});s(10071),s(76701);var r=s(40217),o=s.n(r),a=s(38400),i=s(47083);const{getScrollTarget:n,setVerticalScrollPosition:l}=a.ZP;let c;const p=(0,i.xr)((({app:e,store:t})=>{c={stringToDateTime:e=>{var t=new Date(e),s=(""+t.getFullYear()).slice(-4),r=("0"+(t.getMonth()+1)).slice(-2),o=("0"+t.getDate()).slice(-2),a=("0"+t.getHours()).slice(-2),i=("0"+t.getMinutes()).slice(-2);return o+"/"+r+"/"+s+" à "+a+"H"+i},stringToDate:e=>{var t=new Date(e),s=(""+t.getFullYear()).slice(-4),r=("0"+(t.getMonth()+1)).slice(-2),o=("0"+t.getDate()).slice(-2);return o+"/"+r+"/"+s},stringToDayMonthYear:e=>{var t=new Date(e),s=["JAN","FEV","MAR","AVR","MAI","JUN","JUL","AUO","SEP","OCT","NOV","DEC"],r=s[t.getMonth()],o=t.getFullYear(),a=("0"+t.getDate()).slice(-2);return a+" "+r+" "+o},refFromUID:e=>{let t=("000000"+e).slice(-6);return t},removeDuplicates:(e,t)=>e.filter(((e,s,r)=>r.map((e=>e[t])).indexOf(e[t])===s)),resourcesToFormOptions:e=>{let t=[...new Set(e.map((({id:e})=>e)))],s=[];t.forEach((t=>{s.push(e.find((e=>e.id===t)))}));let r=[];return s.forEach((function(e){let t={label:e.name,value:e.id};r.push(t)})),r},priorityQuasarIdToApiId:e=>{switch(e){case-1:return"low";case 0:return"normal";case 1:return"high"}},priorityApiIdToFrench:e=>{switch(e){case"low":return"Basse";case"normal":return"Normale";case"high":return"Elevée"}},priorityQuasarIdToFrench:e=>{switch(e){case-1:return"Basse";case 0:return"Normale";case 1:return"Elevée"}},decodeToken:e=>{if(null!==e&&""!==e){let t=o().decode(e,"secret",!0);if(null!==t&&t.hasOwnProperty("exp")&&new Date(1e3*t.exp)>=new Date)return t}return{sub:null,exp:null}},isTokenValid:t=>new Promise(((s,r)=>{if(null!==t&&t.length){let a=o().decode(t,"secret",!0);null!==a&&a.hasOwnProperty("exp")&&new Date(1e3*a.exp)>=new Date?s(a):r(e.config.globalProperties.$ErrorHandler.throwNoSession("",new Error("no Session")))}else r(e.config.globalProperties.$ErrorHandler.throwNoSession("",new Error("no Session")))})),statusTranslation:e=>{let t={pending:{color:"warning",label:"En attente",icon:""},ongoing:{color:"primary",label:"En cours",icon:""},done:{color:"positive",label:"Traité",icon:""},rejected:{color:"accent",label:"Rejeté",icon:""}};return t[e]},translatePush:e=>{let t=JSON.parse(e);switch(t.type){case"UserConnected":return{type:t.type,data:t.data,message:"Bienvenue :",detail:"Vous êtes maintenant connecté sur SoWell"};case"IssueCreated":return{type:t.type,data:t.data,message:"Nouvelle demande :",detail:"La demande #"+t.data.id.toString()+" vient d'être créée"};case"IssueUpdated":return{type:t.type,data:t.data,message:"Mise à jour :",detail:"La demande #"+t.data.id.toString()+" vient d'être mise à jour"};case"IssueTalkCreated":return{type:t.type,data:t.data,message:"Nouveau message :",detail:"Un nouveau message vient d'être enregistré sur la demande #"+t.data.id.toString()};default:return{type:t.type,data:t.data,message:"Notification :",detail:t.data.toString()}}},scrollToElement:e=>{let t=n(e),s=e.offsetTop-e.scrollHeight;l(t,s,100)},findOptionName:(e,t)=>{var s;return t&&(null===(s=e.find((e=>e.id===t)))||void 0===s?void 0:s.name)||""}},e.config.globalProperties.$helpers=c,e.provide("$helpers",c)}))},90626:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(47083);const o=(0,r.xr)((({app:e,store:t})=>{const s=e.config.globalProperties.$helpers,r=e.config.globalProperties.$SowellProxy,o=e.config.globalProperties.$DB;t._vm={$helpers:s,$SowellProxy:r,$DB:o}}))},16862:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});s(10071);var r=s(6388),o=s(50811),a=s.n(o),i=s(94475),n=s(47083),l=s(68033);r.Z.plugin(i.Z);const c=(0,n.xr)((({app:e})=>{var t=null,s=null,o=null,i=null,n=null;const c={initRemote:(e,t,s)=>{let o="https://"+e+":"+t+"@5b209f9d-f355-4198-8ba2-896b990b307d-bluemix.cloudantnosqldb.appdomain.cloud/"+s,a={name:"remoteCmpIssues",skip_setup:!0};i=new r.Z(o,a)},processTmpReport:async(t,r)=>{"wip"in t&&!1!==t.wip||(t.wip=!0,s.put(t),await r.createReport(t).then((e=>{for(let s of t.issues)s._id=(0,l.v4)(),s.report.id=parseInt(e.data.id),o.put(s);s.get(t._id).then((e=>{s.remove(e)}))}),(r=>{r[0]["title"].startsWith("duplicate detected")||"Resource not found"==r[0]["title"]?(s.get(t._id).then((e=>{s.remove(e)})),e.config.globalProperties.$q.notify({message:"Ce contrôle a déjà été réalisé il y a moins de 24h",color:"warning",position:"top"})):(t.wip=!1,s.put(t))})))},processTmpIssue:async(t,s)=>{if("new"===t.event&&("wip"in t&&!1!==t.wip||(t.wip=!0,o.put(t),"report"in t&&null===t.report.id&&delete t.report,await s.createIssue(t).then((r=>{t.toForward&&s.forwardIssue(r.data.id,{data:{type:"issues"}}).then((()=>{e.config.globalProperties.$q.notify({message:"Nouveau signalement transmis avec succès",color:"info",position:"top"})}),(()=>{e.config.globalProperties.$q.notify({message:"Le transfert du nouveau signalement a échoué, une erreur est survenue",color:"warning",position:"top"})})),c.deleteTmpIssue(t)}),(e=>{e[0]["title"].startsWith("duplicate detected")?c.deleteTmpIssue(t):(t.wip=!1,o.put(t))})))),"talk"===t.event&&(!("wip"in t)||!1===t.wip)){t.wip=!0,o.put(t);for(const e of t.tracking.talks)await s.createTalk(t._id,e.message).then((()=>{let s=t.tracking.talks.filter((t=>t.message!==e.message));t.tracking.talks=s,o.put(t)}),(e=>{e[0]["title"].startsWith("duplicate detected")?c.deleteTmpIssue(t):(t.wip=!1,o.put(t))}));0===t.tracking.talks.length&&c.deleteTmpIssue(t)}"close"===t.event&&("wip"in t&&!1!==t.wip||(t.wip=!0,o.put(t),await s.updateIssue({id:t._id,status:t.tracking.status}).then((()=>{c.deleteTmpIssue(t)}),(e=>{"0"in e&&"title"in e[0]&&("Access forbiden"===e[0]["title"]||e[0]["title"].startsWith("duplicate detected"))?c.deleteTmpIssue(t):(t.wip=!1,o.put(t))}))))},deleteTmpIssue:e=>o.get(e._id).then((e=>o.remove(e))),replicateIssues:(e,s)=>{null!==n&&n.cancel(),n=t.replicate.from(i,{live:!0,retry:!0,batch_size:20,checkpoint:"target",filter:"remoteFilters/byScopesOrOwner",query_params:{scopes:e.join(","),owner:s}})}},p={initLocal:e=>{let i={auto_compaction:!0};e&&(r.Z.plugin(a()),i={auto_compaction:!0,adapter:"cordova-sqlite",location:"default",androidDatabaseImplementation:2}),t=new r.Z("localCmpIssues.db",i),t.createIndex({index:{fields:["meta.updatedAt"]}}),s=new r.Z("tmpReports.db",i),o=new r.Z("tmpIssues.db",i)},initDBSync(e,t){c.initRemote("cmp_"+e.id,"dfhgs_dih!","cmp_"+e.id),c.replicateIssues(t.scopes,t.id),s.find({selector:{wip:!0}}).then((e=>{for(let t of e.docs)t.wip=!1,s.put(t)})),o.find({selector:{wip:!0}}).then((e=>{for(let t of e.docs)t.wip=!1,o.put(t)}))},syncTmpItems:(e,t)=>{s.find({selector:{ready:!0}}).then((s=>{if(0===s.docs.length)e.dispatch("common/clearPendingReports");else{e.dispatch("common/setPendingReports");for(let e of s.docs)c.processTmpReport(e,t)}})),o.allDocs({include_docs:!0}).then((s=>{if(0===s.rows.length)e.dispatch("common/clearPendingIssues");else{e.dispatch("common/setPendingIssues");for(let e of s.rows)c.processTmpIssue(e.doc,t)}}))},localIssues:()=>t,tmpReports:()=>s,tmpIssues:()=>o,resetLocalDBs:e=>{s.destroy().then((()=>{o.destroy().then((()=>{t.destroy().then((()=>p.initLocal(e)))}))}))}};e.config.globalProperties.$DB=p,e.provide("$DB",p)}))},65768:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(47083),o=s(76237);const a=(0,r.xr)((({router:e,store:t})=>{e.beforeEach(((e,s,r)=>{const a=t.getters["reporter/token"]||null;a||"/login"===e.path||"/ResetPassword"===e.path?o.helpers.isTokenValid(a)&&"login"===e.name&&"issueDetails"===s.name?r({path:"/history"}):r():r("/login")}))}))},34312:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(47083),o=s(25934),a=s.n(o);const i={init:e=>{let t=new(a())({apiUrl:e.apiUrl});return t.define("reporter",{"first-name":"","last-name":"",email:"",password:"",img:"",recipients:[],notifications:[],"can-close-issues":!1,company:{jsonApi:"hasOne",type:"companies"},scopes:{jsonApi:"hasMany",type:"scopes"},residences:{jsonApi:"hasMany",type:"zones"}}),t.define("scope",{name:"","updated-at":""}),t.define("user",{"first-name":"","last-name":"",notifications:[],email:"",password:""}),t.define("company",{name:"",img:"","updated-at":"","show-is-private":!0,"external-issues-url":"","forward-issues":{},"has-audits":!1,"allow-unplanned-audits":!1,"show-unscoped-history":!1,categories:{jsonApi:"hasMany",type:"categories"},agencies:{jsonApi:"hasMany",type:"agencies"}}),t.define("category",{name:"",img:"","has-reasons":!1,"updated-at":"",childs:{jsonApi:"hasMany",type:"categories"},reasons:{jsonApi:"hasMany",type:"reasons"}}),t.define("reason",{name:"",code:""}),t.define("place",{name:"","has-audits":"",spots:{jsonApi:"hasMany",type:"spots"},zone:{jsonApi:"hasOne",type:"zones"},residence:{jsonApi:"hasOne",type:"zones"},issues:{jsonApi:"hasMany",type:"issues"},author:{jsonApi:"hasOne",type:"reporter"}}),t.define("agency",{name:"",residences:{jsonApi:"hasMany",type:"zones"}}),t.define("residence",{name:"",agency:{jsonApi:"hasOne",type:"zones"},places:{jsonApi:"hasMany",type:"places"}}),t.define("zone",{name:"","has-audits":"",agency:{jsonApi:"hasOne",type:"zones"},residences:{jsonApi:"hasMany",type:"zones"}}),t.define("spot",{name:"",nature:"",location:"",code:"",category:{jsonApi:"hasOne",type:"categories"}}),t.define("issue",{message:"",img:null,status:"",location:{},people:{},note:"",disturbance:"",imgs:[],"is-private":!1,"created-at":"","updated-at":"",category:{jsonApi:"hasOne",type:"categories"},author:{jsonApi:"hasOne",type:"users"},spot:{jsonApi:"hasOne",type:"spots"},report:{jsonApi:"hasOne",type:"reports"},checkpoint:{jsonApi:"hasOne",type:"checkpoints"},reason:{jsonApi:"hasOne",type:"reasons"},talks:[]}),t.define("talk",{message:"",issue:{jsonApi:"hasOne",type:"issues"},author:{jsonApi:"hasOne",type:"manager"}}),t.define("audit",{dueAt:"",place:{jsonApi:"hasOne",type:"places"},checklist:{jsonApi:"hasOne",type:"audits"},reports:{jsonApi:"hasMany",type:"reports"}}),t.define("report",{checkpoints:[],audit:{jsonApi:"hasOne",type:"audits"},author:{jsonApi:"hasOne",type:"reporter"}}),t.define("checklist",{name:"",category:{jsonApi:"hasOne",type:"places"},checkpoints:{jsonApi:"hasMany",type:"checkpoints"}}),t.define("checkpoint",{question:"",description:"",category:{jsonApi:"hasOne",type:"checklists"}}),t}};var n=s(40019);let l=null,c=null;const p={getSubscriber:(e,t)=>e.config.globalProperties.$helpers.decodeToken(t).sub},d={install:(e,t)=>{l=t.store,c=e;let s=i.init(t);const r=s.axios.create({baseURL:t.apiUrl});s.axios=r,s.insertMiddlewareBefore("axios-request",{name:"axios-request",req:function(e){return e.req.timeout=1e4,e}}),s.isOnMobile=!1,s.axios.interceptors.request.use((function(e){return e.headers["X-Is-Request-From-Mobile"]=s.isOnMobile,e})),s.authenticate=(e,t,r)=>new Promise(((o,a)=>{s.axios.post("/tokens",{auth:{email:e.email,password:e.password},device:{manufacturer:t.manufacturer,model:t.model,platform:t.platform,version:t.version},app:{versionNumber:r.versionNumber}},{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}).then((e=>{o(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{a(e)}))}))})),s.authenticateWithToken=e=>new Promise(((r,o)=>{s.axios.post(s.apiUrl+"/auth",{auth:{email:e.email,token:e.token}},{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}).then((e=>{t.store.dispatch("reporter/setToken",e.data.jwt),t.store.dispatch("reporter/setReporter"),r(e)}),(e=>{n.log("passwordReset => Error"),o(e)}))})),s.resetPassword=e=>new Promise(((t,r)=>{s.axios.post(s.apiUrl+"/auth/reset_password",{auth:{email:e,base:"https://reporter.sowellapp.com"}},{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}).then((e=>{t(e)}),(e=>{n.log("resetPassword => Error"),r(e)}))})),s.loadReporter=()=>new Promise(((e,t)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.find("reporter",p.getSubscriber(c,l.getters["reporter/token"]),{"fields[reporters]":"email,first-name,last-name,img,company,recipients,can-close-issues","fields[companies]":"id,name,updated-at,show-is-private,external-issues-url,forward-issues,has-audits,allow-unplanned-audits,show-unscoped-history",include:"company"}).then((t=>{e(t)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{t(e)}))}))})),s.loadReporterScopes=()=>new Promise(((e,t)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("reporter",p.getSubscriber(c,l.getters["reporter/token"])).all("scopes").get({"fields[scopes]":"name,updated-at"}).then((t=>{e(t)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{t(e)}))}))})),s.loadCompanyCategories=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("company",e.id).all("categories").get({"fields[categories]":"id,name,img,has-reasons,childs",include:"childs"}).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{r(e)}))}))})),s.loadCategoryReasons=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("category",e).all("reasons").get({"fields[reasons]":"id,name"}).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{r(e)}))}))})),s.loadReporterResidences=()=>new Promise(((e,t)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("reporter",p.getSubscriber(c,l.getters["reporter/token"])).all("residences").get({"fields[zones]":"id,name","fields[residences]":"id,name,agency,places","fields[places]":"id,name",include:"agency,places"}).then((t=>{e(t)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{t(e)}))}))})),s.loadReporterPlaces=()=>new Promise(((e,t)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("reporter",p.getSubscriber(c,l.getters["reporter/token"])).all("places").get({"fields[places]":"id,name,residence","fields[residences]":"id,name,agency,places","fields[zones]":"id,name","page[limit]":200,include:"residence.agency"}).then((t=>{e(t)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{t(e)}))}))})),s.loadReporterNotifications=()=>new Promise(((e,t)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.find("reporter",p.getSubscriber(c,l.getters["reporter/token"]),{"fields[reporters]":"notifications"}).then((t=>{e(t)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{t(e)}))}))})),s.clearReporterNotifications=()=>new Promise(((e,t)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.headers["Accept"]="application/vnd.api+json",s.headers["Content-Type"]="application/vnd.api+json",s.one("user",p.getSubscriber(c,l.getters["reporter/token"])).all("notifications").destroy().then((t=>{e(t)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{t(e)}))}))})),s.loadReporterIssues=(e="1970-01-01T00:00:00.000Z",t=50)=>new Promise(((r,o)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("reporter",p.getSubscriber(c,l.getters["reporter/token"])).all("issues").get({"fields[issues]":"disturbance,talks,status,message,people,location,is-private,created-at,updated-at,category,author","fields[categories]":"id","fields[users]":"id","page[limit]":t,"filter[since]":e,sort:"-updated-at",include:"category,author"}).then((e=>{r(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{o(e)}))}))})),s.updateUserPassword=e=>new Promise(((t,r)=>{s.update("user",{id:l.getters["reporter/attributes"].id,password:e}).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{r(e)}))}))})),s.updateIssue=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.headers["Content-Type"]="application/vnd.api+json",s.update("issue",{id:e.id,status:e.status}).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{r(e)}))}))})),s.createIssue=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.headers["Content-Type"]="application/vnd.api+json",s.create("issue",e).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("Impossible de créer ce signalement",e).then((e=>{r(e)}))}))})),s.loadAudits=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("checklister",p.getSubscriber(c,l.getters["reporter/token"])).all("audits").get({"fields[audits]":"due-at,place,checklist","fields[places]":"name,zone,spots","fields[spots]":"name,category","fields[zones]":"name","fields[checklists]":"name,category","fields[categories]":"id","filter[due-until]":e,include:"place.zone,place.spots.category,checklist.category","page[limit]":200}).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{r(e)}))}))})),s.loadPlaceAudits=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("place",e).all("audits").get({"fields[audits]":"due-at,place,checklist","fields[checklists]":"name,category","fields[places]":"name,zone,spots","fields[spots]":"name,category","fields[categories]":"id,img",include:"place.zone,place.spots.category,checklist.category","page[limit]":200}).then((e=>{t(e)}),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>{r(e)}))}))})),s.loadCheckpoints=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("audit",e).all("checkpoints").get({include:"category","fields[checkpoints]":"question,description,category","fields[categories]":"id"}).then((e=>t(e)),(e=>c.config.globalProperties.$ErrorHandler.process("",e).then((e=>r(e)))))})),s.createReport=e=>new Promise(((t,r)=>{e.checkpoints.forEach((e=>{null===e.asserted?delete e.asserted:delete e.missing})),s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.headers["Content-Type"]="application/vnd.api+json",s.create("report",{checkpoints:e.checkpoints,audit:{id:e.audit.id}}).then((e=>{t(e)}),(e=>{let t="Impossible d'intialiser ce rapport";c.config.globalProperties.$ErrorHandler.process(t,e).then((e=>{r(e)}))}))})),s.createTalk=(e="",t="")=>new Promise(((r,o)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.headers["Content-Type"]="application/vnd.api+json",s.create("talk",{message:t,issue:{id:e.toString()}}).then((e=>{r(e)}),(e=>{let t="Impossible d'envoyer votre message";c.config.globalProperties.$ErrorHandler.process(t,e).then((e=>{o(e)}))}))})),s.sendAlert=(e="",t="")=>new Promise(((r,o)=>{let a=s.apiUrl+"/alerts",i={"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json",Authorization:"Bearer "+l.getters["reporter/token"]};s.axios.post(a,{data:{type:"alerts",attributes:{lonlat:e,message:t}}},{headers:i}).then((e=>r(e)),(e=>{let t="Impossible de créer ce signalement";c.config.globalProperties.$ErrorHandler.process(t,e).then((e=>{o(e)}))}))})),s.loadCompanyAgencies=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("company",e).all("agencies").get({"fields[agencies]":"id,name","page[limit]":500}).then((e=>t(e)),(e=>{c.config.globalProperties.$ErrorHandler.process("",e).then((e=>r(e)))}))})),s.loadAgencyResidences=(e,t=!1)=>new Promise(((r,o)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("agency",e).all("residences").get({"fields[residences]":t?"id,name,has-audits":"id,name","page[limit]":500}).then((e=>r(e)),(e=>c.config.globalProperties.$ErrorHandler.process("",e).then((e=>o(e)))))})),s.loadResidencePlaces=(e,t=!1)=>new Promise(((r,o)=>{const{id:a}=l.getters["company/attributes"],i=[191,21],n=i.includes(a)?1e3:500;s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("residence",e).all("places").get({"fields[places]":t?"id,name,has-audits":"id,name","page[limit]":n}).then((e=>r(e)),(e=>c.config.globalProperties.$ErrorHandler.process("",e).then((e=>o(e)))))})),s.loadPlaceSpots=e=>new Promise(((t,r)=>{s.headers["Authorization"]="Bearer "+l.getters["reporter/token"],s.one("place",e).all("spots").get({"fields[spots]":"id,name,category","fields[categories]":"id","page[limit]":500,include:"category"}).then((e=>t(e)),(e=>c.config.globalProperties.$ErrorHandler.process("",e).then((e=>r(e)))))})),s.forwardIssue=(e,t)=>new Promise(((r,o)=>{s.axios.post(s.apiUrl+`/issues/${e}/forward`,t,{headers:{Accept:"application/vnd.api+json",Authorization:"Bearer "+l.getters["reporter/token"]}}).then((e=>{r(e)}),(e=>{n.log("sowell-api => forward-issue => error"),o(e)}))})),s.issuesByPlaceId=e=>new Promise(((t,r)=>{s.one("place",e).all("issues").get({"fields[categories]":"id,img,name","fields[users]":"id,first-name","page[limit]":500,include:"category,author"}).then((e=>{t(e.data)})).catch((e=>{r(e)}))})),e.config.globalProperties.$SowellProxy=s}},u=(0,r.xr)((({app:e,router:t,store:s})=>{window.Cypress&&(window.app={$store:s}),e.use(d,{apiUrl:"https://api.sowellapp.com",store:s,router:t,app:e})}))},86310:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});s(10071);var r=s(30798),o=s.n(r);const a={$on:(...e)=>o().on(...e),$once:(...e)=>o().once(...e),$off:(...e)=>o().off(...e),$emit:(...e)=>o().emit(...e)}},69698:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var r=s(47083),o=s(93617),a=s(52363);const i={hasPendingReports:!1,hasPendingIssues:!1,appRestartRequired:!1},n={hasPendingChanges:e=>e.hasPendingReports||e.hasPendingIssues,appRestartRequired:e=>e.appRestartRequired},l={setPendingReports({commit:e}){e("SET_HAS_PENDING_REPORTS",!0)},clearPendingReports({commit:e}){e("SET_HAS_PENDING_REPORTS",!1)},setPendingIssues({commit:e}){e("SET_HAS_PENDING_ISSUES",!0)},clearPendingIssues({commit:e}){e("SET_HAS_PENDING_ISSUES",!1)},setAppRequiresRestart({commit:e},t){e("SET_APP_RESTART_REQUIRED",t)},reset({commit:e}){e("RESET")}},c={SET_HAS_PENDING_REPORTS(e,t){e.hasPendingReports=t},SET_HAS_PENDING_ISSUES(e,t){e.hasPendingIssues=t},SET_APP_RESTART_REQUIRED(e,t){e.appRestartRequired=t},RESET(e){e.hasPendingReports=!1,e.hasPendingIssues=!1}},p={state:i,getters:n,actions:l,mutations:c,namespaced:!0};s(10071);const d={id:null,email:"",password:"",firstName:"",lastName:"",img:"",canCloseIssues:!1,recipients:[],agencies:[],notifications:[],token:"",scopes:[]},u={attributes:e=>({id:e.id,firstName:e.firstName,lastName:e.lastName,img:e.img,canCloseIssues:e.canCloseIssues,recipients:e.recipients,scopes:e.scopes}),token:e=>e.token,agencies:e=>e.agencies,residences:e=>{let t=[];return e.agencies.forEach((e=>{t=[...t,...e.residences]})),t},places:e=>{let t=[];return e.agencies.forEach((e=>{e.residences.forEach((e=>{t=[...t,...e.places]}))})),t},notifications:e=>e.notifications,notificationsCount:e=>e.notifications.length},h={authenticate({commit:e,dispatch:t,rootGetters:s},{credentials:r,device:o,appVersion:a}){return new Promise((i=>{this._vm.$SowellProxy.authenticate(r,o,a).then((r=>{e("SET_TOKEN",r.data.jwt),t("setReporter").then((e=>{let r=null,o=null;new Date(e.data.company["updated-at"]).getTime()>=new Date(s["company/attributes"].updatedAt).getTime()?(r=t("company/load",e.data.company,{root:!0}),o=new Promise((e=>{this._vm.$SowellProxy.loadReporterPlaces().then((s=>{t("setAgencies",s.data),t("setSpots",s.data),e()}))}))):(r=new Promise((e=>e())),o=new Promise((e=>e()))),Promise.all([r,o]).then((()=>i()))}))}))}))},setToken:({commit:e},t)=>{e("SET_TOKEN",t)},setReporter({commit:e}){return new Promise((t=>{this._vm.$SowellProxy.loadReporter().then((s=>{let r={id:Math.trunc(s.data.id),email:s.data.email,firstName:s.data["first-name"],lastName:s.data["last-name"],recipients:s.data.recipients,img:s.data.img,canCloseIssues:s.data["can-close-issues"]};this._vm.$SowellProxy.loadReporterScopes().then((o=>{r.scopes=o.data.map((e=>e.id)),e("SET_ALL",r),t(s)}))}))}))},async setAgencies({commit:e},t){let s=[];t.forEach((async e=>{var t,r;if(null!==(t=e.residence)&&void 0!==t&&null!==(r=t.agency)&&void 0!==r&&r.id){let t=s.find((t=>t.id===e.residence.agency.id));void 0===t&&(t=e.residence.agency,t.residences=[],s.push(t));let r=t.residences.find((t=>t.id===e.residence.id));r||(r=e.residence,delete r.agency,t.residences.push(r)),delete e.residence,r.places.push(e)}})),e("SET_AGENCIES",s)},async setSpots({commit:e},t){const s=[];for(const r of t)await this._vm.$SowellProxy.loadPlaceSpots(r.id).then((e=>{s.push({placeId:r.id,spots:e.data.map((e=>({id:Math.trunc(e.id),name:e.name,categoryId:Math.trunc(e.category.id)})))})}));e("SET_SPOTS",s)},sendAlert({commit:e},t){return new Promise((e=>{this._vm.$SowellProxy.sendAlert(t.lonlat,t.message).then((t=>e(t)))}))},logout({commit:e}){e("LOGOUT")},setNotifications({commit:e},t){e("SET_NOTIFICATIONS",t)},clearIssueNotifications({commit:e},t){e("CLEAR_ISSUE_NOTIFICATIONS",t)},reset({dispatch:e,commit:t}){t("RESET"),e("audits/reset",null,{root:!0}),e("company/reset",null,{root:!0}),e("common/reset",null,{root:!0})}},m={SET_ALL(e,t){e.id=t.id,e.email=t.email,e.firstName=t.firstName,e.lastName=t.lastName,e.img=t.img,e.canCloseIssues=t.canCloseIssues,e.recipients=t.recipients,e.scopes=t.scopes},SET_AGENCIES(e,t){e.agencies=t},SET_SPOTS(e,t){e.agencies.forEach((e=>{e.residences.forEach((e=>{e.places.forEach((e=>{e.spots=t.find((t=>parseInt(t.placeId)===parseInt(e.id))).spots}))}))}))},SET_TOKEN(e,t){e.token=t},SET_NOTIFICATIONS(e,t){t.forEach((t=>{e.notifications.push(t)}))},CLEAR_ISSUE_NOTIFICATIONS(e,t){e.notifications=e.notifications.filter((e=>e.id!==t.meta.id))},LOGOUT(e){e.token=""},RESET(e){e.id=null,e.firstName="",e.lastName="",e.img="",e.canCloseIssues=!1,e.recipients=[],e.agencies=[],e.token="",e.notifications=[],e.scopes=[]}},g={state:d,getters:u,actions:h,mutations:m,namespaced:!0},_={id:null,name:null,categories:[],showIsPrivate:!0,updatedAt:"1970-01-01T00:00:00.000Z",externalIssuesUrl:null,hasAudits:!1,allowUnplannedAudits:!1,showUnscopedHistory:!1,forwardIssues:{}},f={attributes:e=>({id:e.id,name:e.name,showIsPrivate:e.showIsPrivate,updatedAt:e.updatedAt,externalIssuesUrl:e.externalIssuesUrl,hasAudits:e.hasAudits,allowUnplannedAudits:e.allowUnplannedAudits,showUnscopedHistory:e.showUnscopedHistory,forwardIssues:e.forwardIssues}),categories:e=>e.categories,findCategoryBySubcategoryId:e=>t=>e.categories.find((e=>e.childs.map((e=>e.id)).includes(t))),findCategoryById:e=>t=>{let s=null;return e.categories.forEach((e=>{e.childs.forEach((e=>{e.id===t&&(s=e)}))})),s}},w={load({commit:e},t){return new Promise((s=>this._vm.$SowellProxy.loadCompanyCategories(t).then((r=>{let o={id:Math.trunc(t.id),name:t.name,updatedAt:t["updated-at"],showIsPrivate:t["show-is-private"],externalIssuesUrl:t["external-issues-url"],hasAudits:t["has-audits"],allowUnplannedAudits:t["allow-unplanned-audits"],showUnscopedHistory:t["show-unscoped-history"],forwardIssues:t["forward-issues"],categories:r.data.filter((e=>e.childs.length)).map((e=>({id:Math.trunc(e.id),name:e.name,img:e.img,childs:e.childs.map((e=>{const t={id:Math.trunc(e.id),name:e.name,img:e.img};return e["has-reasons"]&&this._vm.$SowellProxy.loadCategoryReasons(e.id).then((e=>{t.reasons=e.data})),t}))})))};e("SET_ALL",o),s(r)}))))},reset({commit:e}){e("RESET")}},b={SET_ALL(e,t){e.id=t.id,e.name=t.name,e.categories=t.categories,e.showIsPrivate=t.showIsPrivate,e.hasAudits=t.hasAudits,e.allowUnplannedAudits=t.allowUnplannedAudits,e.showUnscopedHistory=t.showUnscopedHistory,e.updatedAt=t.updatedAt,e.externalIssuesUrl=t.externalIssuesUrl,e.forwardIssues=t.forwardIssues},RESET(e){e.id=null,e.name=null,e.categories=[],e.showIsPrivate=!0,e.updatedAt="1970-01-01T00:00:00.000Z",e.externalIssuesUrl=null,e.hasAudits=!1,e.allowUnplannedAudits=!1,e.showUnscopedHistory=!1,e.forwardIssues={}}},y={state:_,getters:f,actions:w,mutations:b,namespaced:!0},k={untillDate:null,all:[],isLoadingAudits:!0,auditsInOtherScopes:[]},P={all:e=>e.all,reduceResidences:e=>{let t=S.removeDuplicates(Array.from(e.all,(e=>e.place.zone)),"id");return t.forEach((t=>{let s=e.all.filter((e=>e.place.zone.id===t.id)),r=S.removeDuplicates(Array.from(s,(e=>e.place)),"id"),o=0;r.forEach((t=>{let s=e.all.filter((e=>e.place.id===t.id));t.auditsCount=s.length,o+=t.auditsCount})),t.auditsCount=o})),t.sort(((e,t)=>e.name.localeCompare(t.name)))},reducePlacesByResidence:e=>t=>{let s=e.all.filter((e=>e.place.zone.id===parseInt(t))),r=S.removeDuplicates(Array.from(s,(e=>e.place)),"id");return r.forEach((t=>{let s=e.all.filter((e=>e.place.id===t.id));t.auditsCount=s.length})),r.sort(((e,t)=>{let s=e.name.split(" "),r=s[0];delete s[0];let o=s+r,a=t.name.split(" "),i=a[0];delete a[0];let n=a+i;return o.localeCompare(n,"fr",{numeric:!0,ignorePunctuation:!0})}))},byPlace:e=>t=>e.all.filter((e=>e.place.id===parseInt(t))),isControleChanged:e=>e.isLoadingAudits,auditsInOtherScopes:e=>e.auditsInOtherScopes},j={load({commit:e,state:t}){return new Promise((s=>{let r=this._vm.$helpers.stringToDate(S.nextDueDate());t.untillDate!==r?this._vm.$SowellProxy.loadAudits(r).then((async t=>{e("COMMIT_UNTILL_DATE",r);let o=t.data;for(const e in o){let t=o[e];t.report={id:null,checkpoints:[],"done-at":null},t.checklist.id=Math.trunc(t.checklist.id),t.checklist.category.id=Math.trunc(t.checklist.category.id),t.place.id=Math.trunc(t.place.id),t.place.zone.id=Math.trunc(t.place.zone.id),t.report.id=Math.trunc(t.report.id),await this._vm.$SowellProxy.loadCheckpoints(t.id).then((e=>{t.checklist.checkpoints=S.serialize(e.data)}))}e("COMMIT_ALL",S.serialize(t.data)),s(),e("SET_CONTROL_LOADED")})):(s(),e("SET_CONTROL_LOADED"))}))},loadAuditsInOtherScopes({commit:e},t){return new Promise(((s,r)=>{e("SET_CONTROL_LOADING"),this._vm.$SowellProxy.loadPlaceAudits(t.id).then((async t=>{if(0===t.data.length)return s([]);{let r=t.data,o=[];for(const e in r){let t={...r[e]};t.id=+t.id,t.report={id:null,checkpoints:[],"done-at":null},t.checklist.id=+t.checklist.id,t.checklist.category.id=+t.checklist.category.id,t.place.id=+t.place.id,t.place.zone.id=+t.place.zone.id,t.report.id=+t.report.id,await this._vm.$SowellProxy.loadCheckpoints(t.id).then((e=>{t.checklist.checkpoints=S.serialize(e.data)})),o=[...o,t]}return e("ADD_AUDITS_FROM_OTHER_SCOPE",o),e("SET_CONTROL_LOADED"),s(o)}}),(()=>(e("SET_CONTROL_LOADED"),this.$q.loading.hide(),r("ERROR LOADING AUDITS"))))}))},close({commit:e},t){e("CLOSE_AUDIT",t)},reset({commit:e},t){e("RESET",t),e("RESET_AUDITS_IN_OTHER_SCOPES",t)}},v={COMMIT_ALL(e,t){e.all=t},COMMIT_UNTILL_DATE(e,t){e.untillDate=t},RESET(e){e.untillDate=null,e.all=[],e.isLoadingAudits=!0},CLOSE_AUDIT(e,t){e.all=e.all.filter((e=>e.id!==t.id))},SET_CONTROL_LOADED(e){e.isLoadingAudits=!1},SET_CONTROL_LOADING(e){e.isLoadingAudits=!0},RESET_AUDITS_IN_OTHER_SCOPES(e){e.auditsInOtherScopes=[]},ADD_AUDITS_FROM_OTHER_SCOPE(e,t){e.auditsInOtherScopes=t.map((e=>S.serialize(e)))}},S={serialize:e=>Array.isArray(e)?e.map((e=>(e.id=Math.trunc(e.id),e))):(e.id=Math.trunc(e.id),e),nextDueDate:()=>{var e=7,t=new Date,s=e-t.getDay();return s<7?t.setDate(t.getDate()+s):t.setDate(t.getDate()),t},removeDuplicates:(e,t)=>e.filter(((e,s,r)=>r.map((e=>e[t])).indexOf(e[t])===s))},E={state:k,getters:P,actions:j,mutations:v,namespaced:!0},A={checkedReports:[]},I={checkedReports:e=>e.checkedReports},T={setcheckedReport({commit:e},t){e("SET_CHECKED_REPORT",t)},reset({commit:e},t){e("RESET",t)}},O={SET_CHECKED_REPORT(e,t){const s=e.checkedReports.find((e=>e.auditId===t.auditId));s?e.checkedReports.find((e=>{e.auditId===t.auditId&&(e.auditId=t.auditId,e.id=t.id)})):e.checkedReports.push(t)},RESET(e,t){e.checkedReports=e.checkedReports.filter((e=>e.auditId!==t))}},$={state:A,getters:I,actions:T,mutations:O,namespaced:!0},R=(0,r.h)((function(){const e=(0,o.MT)({modules:{common:p,reporter:g,company:y,audits:E,report:$},plugins:[(0,a.Z)({paths:["common","reporter","company","audits","report"]})]});return e}))},46700:(e,t,s)=>{var r={"./af":5809,"./af.js":5809,"./ar":46069,"./ar-dz":70481,"./ar-dz.js":70481,"./ar-kw":93994,"./ar-kw.js":93994,"./ar-ly":33312,"./ar-ly.js":33312,"./ar-ma":90239,"./ar-ma.js":90239,"./ar-sa":31863,"./ar-sa.js":31863,"./ar-tn":19607,"./ar-tn.js":19607,"./ar.js":46069,"./az":69281,"./az.js":69281,"./be":29945,"./be.js":29945,"./bg":59384,"./bg.js":59384,"./bm":21476,"./bm.js":21476,"./bn":43345,"./bn-bd":70216,"./bn-bd.js":70216,"./bn.js":43345,"./bo":81713,"./bo.js":81713,"./br":19655,"./br.js":19655,"./bs":87296,"./bs.js":87296,"./ca":43049,"./ca.js":43049,"./cs":62722,"./cs.js":62722,"./cv":98039,"./cv.js":98039,"./cy":95563,"./cy.js":95563,"./da":31960,"./da.js":31960,"./de":67533,"./de-at":76674,"./de-at.js":76674,"./de-ch":17732,"./de-ch.js":17732,"./de.js":67533,"./dv":78343,"./dv.js":78343,"./el":37004,"./el.js":37004,"./en-au":32517,"./en-au.js":32517,"./en-ca":84929,"./en-ca.js":84929,"./en-gb":99722,"./en-gb.js":99722,"./en-ie":96923,"./en-ie.js":96923,"./en-il":68050,"./en-il.js":68050,"./en-in":99624,"./en-in.js":99624,"./en-nz":70540,"./en-nz.js":70540,"./en-sg":14375,"./en-sg.js":14375,"./eo":10040,"./eo.js":10040,"./es":99720,"./es-do":25595,"./es-do.js":25595,"./es-mx":10180,"./es-mx.js":10180,"./es-us":61563,"./es-us.js":61563,"./es.js":99720,"./et":9217,"./et.js":9217,"./eu":39474,"./eu.js":39474,"./fa":85243,"./fa.js":85243,"./fi":57645,"./fi.js":57645,"./fil":55350,"./fil.js":55350,"./fo":75622,"./fo.js":75622,"./fr":91467,"./fr-ca":53439,"./fr-ca.js":53439,"./fr-ch":14335,"./fr-ch.js":14335,"./fr.js":91467,"./fy":86026,"./fy.js":86026,"./ga":32969,"./ga.js":32969,"./gd":21347,"./gd.js":21347,"./gl":11085,"./gl.js":11085,"./gom-deva":904,"./gom-deva.js":904,"./gom-latn":69597,"./gom-latn.js":69597,"./gu":28705,"./gu.js":28705,"./he":69128,"./he.js":69128,"./hi":92821,"./hi.js":92821,"./hr":9002,"./hr.js":9002,"./hu":94814,"./hu.js":94814,"./hy-am":30658,"./hy-am.js":30658,"./id":29344,"./id.js":29344,"./is":55838,"./is.js":55838,"./it":70376,"./it-ch":81549,"./it-ch.js":81549,"./it.js":70376,"./ja":69293,"./ja.js":69293,"./jv":96401,"./jv.js":96401,"./ka":60482,"./ka.js":60482,"./kk":87329,"./kk.js":87329,"./km":44241,"./km.js":44241,"./kn":23566,"./kn.js":23566,"./ko":52742,"./ko.js":52742,"./ku":92915,"./ku.js":92915,"./ky":86846,"./ky.js":86846,"./lb":44959,"./lb.js":44959,"./lo":82188,"./lo.js":82188,"./lt":58967,"./lt.js":58967,"./lv":41245,"./lv.js":41245,"./me":90751,"./me.js":90751,"./mi":57501,"./mi.js":57501,"./mk":11643,"./mk.js":11643,"./ml":15597,"./ml.js":15597,"./mn":67612,"./mn.js":67612,"./mr":19065,"./mr.js":19065,"./ms":84703,"./ms-my":84645,"./ms-my.js":84645,"./ms.js":84703,"./mt":64365,"./mt.js":64365,"./my":83788,"./my.js":83788,"./nb":57357,"./nb.js":57357,"./ne":99109,"./ne.js":99109,"./nl":63746,"./nl-be":31985,"./nl-be.js":31985,"./nl.js":63746,"./nn":27175,"./nn.js":27175,"./oc-lnc":70566,"./oc-lnc.js":70566,"./pa-in":32733,"./pa-in.js":32733,"./pl":182,"./pl.js":182,"./pt":505,"./pt-br":17839,"./pt-br.js":17839,"./pt.js":505,"./ro":39578,"./ro.js":39578,"./ru":32328,"./ru.js":32328,"./sd":641,"./sd.js":641,"./se":51758,"./se.js":51758,"./si":36680,"./si.js":36680,"./sk":25016,"./sk.js":25016,"./sl":7424,"./sl.js":7424,"./sq":88635,"./sq.js":88635,"./sr":49038,"./sr-cyrl":73716,"./sr-cyrl.js":73716,"./sr.js":49038,"./ss":64771,"./ss.js":64771,"./sv":3517,"./sv.js":3517,"./sw":39419,"./sw.js":39419,"./ta":55959,"./ta.js":55959,"./te":21739,"./te.js":21739,"./tet":22264,"./tet.js":22264,"./tg":94792,"./tg.js":94792,"./th":88328,"./th.js":88328,"./tk":60702,"./tk.js":60702,"./tl-ph":57814,"./tl-ph.js":57814,"./tlh":10797,"./tlh.js":10797,"./tr":16691,"./tr.js":16691,"./tzl":76891,"./tzl.js":76891,"./tzm":16362,"./tzm-latn":37855,"./tzm-latn.js":37855,"./tzm.js":16362,"./ug-cn":77606,"./ug-cn.js":77606,"./uk":30513,"./uk.js":30513,"./ur":43803,"./ur.js":43803,"./uz":60344,"./uz-latn":8957,"./uz-latn.js":8957,"./uz.js":60344,"./vi":70003,"./vi.js":70003,"./x-pseudo":8842,"./x-pseudo.js":8842,"./yo":62083,"./yo.js":62083,"./zh-cn":84536,"./zh-cn.js":84536,"./zh-hk":92475,"./zh-hk.js":92475,"./zh-mo":67593,"./zh-mo.js":67593,"./zh-tw":4746,"./zh-tw.js":4746};function o(e){var t=a(e);return s(t)}function a(e){if(!s.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id=46700},46601:()=>{},89214:()=>{},71922:()=>{},2363:()=>{},96419:()=>{},56353:()=>{},69386:()=>{},31616:()=>{},15525:()=>{},24654:()=>{},69862:()=>{},40964:()=>{}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.loaded=!0,s.exports}__webpack_require__.m=__webpack_modules__,(()=>{var e=[];__webpack_require__.O=(t,s,r,o)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,r,o]=e[c],i=!0,n=0;n<s.length;n++)(!1&o||a>=o)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](s[n])))?s.splice(n--,1):(i=!1,o<a&&(a=o));if(i){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,r,o]}})(),(()=>{__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return __webpack_require__.d(t,{a:t}),t}})(),(()=>{__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,s)=>(__webpack_require__.f[s](e,t),t)),[]))})(),(()=>{__webpack_require__.u=e=>"js/"+(64===e?"chunk-common":e)+"."+{34:"b8b6f847",64:"833b6b2d",70:"db82464b",72:"bb81c403",129:"6511cd77",131:"434e3ee9",246:"5af04cc4",265:"ea89306a",302:"4c9e3f54",341:"e108b56c",354:"8d087a79",395:"766fd353",533:"fe7ccb45",535:"12ef4643",666:"3b389a83",677:"26ca6cc0"}[e]+".js"})(),(()=>{__webpack_require__.miniCssF=e=>"css/"+({143:"app",736:"vendor"}[e]||e)+"."+{34:"cbe5af2a",72:"f6bba3ea",129:"81170e30",131:"e7cd91ef",143:"c819c6e0",246:"ac99967e",265:"f05ad4f9",341:"a64f288f",535:"bd8426fa",666:"81170e30",677:"a64f288f",736:"27d7cd52"}[e]+".css"})(),(()=>{__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="reporter:";__webpack_require__.l=(s,r,o,a)=>{if(e[s])e[s].push(r);else{var i,n;if(void 0!==o)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var p=l[c];if(p.getAttribute("src")==s||p.getAttribute("data-webpack")==t+o){i=p;break}}i||(n=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.setAttribute("nonce",__webpack_require__.nc),i.setAttribute("data-webpack",t+o),i.src=s),e[s]=[r];var d=(t,r)=>{i.onerror=i.onload=null,clearTimeout(u);var o=e[s];if(delete e[s],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(r))),t)return t(r)},u=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),n&&document.head.appendChild(i)}}})(),(()=>{__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{__webpack_require__.p=""})(),(()=>{var e=(e,t,s,r)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css";var a=a=>{if(o.onerror=o.onload=null,"load"===a.type)s();else{var i=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=i,l.request=n,o.parentNode.removeChild(o),r(l)}};return o.onerror=o.onload=a,o.href=t,document.head.appendChild(o),o},t=(e,t)=>{for(var s=document.getElementsByTagName("link"),r=0;r<s.length;r++){var o=s[r],a=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(a===e||a===t))return o}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){o=i[r],a=o.getAttribute("data-href");if(a===e||a===t)return o}},s=s=>new Promise(((r,o)=>{var a=__webpack_require__.miniCssF(s),i=__webpack_require__.p+a;if(t(a,i))return r();e(s,i,r,o)})),r={143:0};__webpack_require__.f.miniCss=(e,t)=>{var o={34:1,72:1,129:1,131:1,246:1,265:1,341:1,535:1,666:1,677:1};r[e]?t.push(r[e]):0!==r[e]&&o[e]&&t.push(r[e]=s(e).then((()=>{r[e]=0}),(t=>{throw delete r[e],t})))}})(),(()=>{var e={143:0};__webpack_require__.f.j=(t,s)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)s.push(r[2]);else{var o=new Promise(((s,o)=>r=e[t]=[s,o]));s.push(r[2]=o);var a=__webpack_require__.p+__webpack_require__.u(t),i=new Error,n=s=>{if(__webpack_require__.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var o=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",i.name="ChunkLoadError",i.type=o,i.request=a,r[1](i)}};__webpack_require__.l(a,n,"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,s)=>{var r,o,[a,i,n]=s,l=0;if(a.some((t=>0!==e[t]))){for(r in i)__webpack_require__.o(i,r)&&(__webpack_require__.m[r]=i[r]);if(n)var c=n(__webpack_require__)}for(t&&t(s);l<a.length;l++)o=a[l],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[a[l]]=0;return __webpack_require__.O(c)},s=self["webpackChunkreporter"]=self["webpackChunkreporter"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var __webpack_exports__=__webpack_require__.O(void 0,[736],(()=>__webpack_require__(65937)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();