"use strict";(self["webpackChunkreporter"]=self["webpackChunkreporter"]||[]).push([[265],{13265:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I});var s=o(83673),r=o(98880);const i={class:"row q-pt-lg justify-center",ref:"top"},a=(0,s._)("div",{class:"col-12 text-center q-pt-xl"},[(0,s._)("p",{style:{"font-family":"'Arima'",opacity:"0.7"}},[(0,s.Uk)(" Veuillez saisir vos identifiants d'accès "),(0,s._)("br")])],-1),l={class:"col-10 offset-1 q-pb-sm"},n={class:"forgottenPass"},d=(0,s._)("p",{style:{"font-family":"'Arima'",opacity:"0.7"}}," Veuillez entrer votre email : ",-1),c=(0,s._)("div",null,[(0,s._)("b",null,"Précisions :")],-1),m=(0,s.Uk)(" En cochant cette case, l'application va recharger l'ensemble de votre patrimoine. Assurez-vous d'avoir un bon réseau. "),p={class:"col-12 text-center"},u=(0,s.Uk)("Connexion"),h={class:"col-12 text-center sw-login-clear"};function f(e,t,o,f,g,w){const v=(0,s.up)("q-input"),q=(0,s.up)("q-field"),$=(0,s.up)("q-btn"),y=(0,s.up)("q-card-section"),b=(0,s.up)("q-card-actions"),_=(0,s.up)("q-card"),V=(0,s.up)("q-dialog"),W=(0,s.up)("q-space"),k=(0,s.up)("q-checkbox"),C=(0,s.up)("q-icon"),P=(0,s.up)("q-page"),Z=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.j4)(P,null,{default:(0,s.w5)((()=>[(0,s._)("div",i,[a,(0,s._)("div",l,[(0,s._)("form",null,[(0,s.Wm)(q,{icon:"mail",label:"Email","icon-color":"primary","error-label":"Merci de saisir une adresse email valide",borderless:""},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{type:"email",modelValue:g.form.email,"onUpdate:modelValue":t[0]||(t[0]=e=>g.form.email=e),onChange:f.v$.form.email.$touch,onBlur:t[1]||(t[1]=(0,r.iM)((t=>w.$helpers.scrollToElement(e.$refs.pws.$el)),["stop"])),onKeyup:t[2]||(t[2]=(0,r.D2)((t=>w.$helpers.scrollToElement(e.$refs.pws.$el)),["enter"])),error:f.v$.form.email.$error,class:"full-width",autocomplete:"username"},null,8,["modelValue","onChange","error"])])),_:1}),(0,s.Wm)(q,{icon:"lock",label:"Mot de passe","icon-color":"primary","error-label":"Merci de saisir votre mot de passe",borderless:""},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{ref:"pws",type:"password",modelValue:g.form.pass,"onUpdate:modelValue":t[3]||(t[3]=e=>g.form.pass=e),onChange:f.v$.form.pass.$touch,onBlur:t[4]||(t[4]=(0,r.iM)((t=>w.$helpers.scrollToElement(e.$refs.top)),["stop"])),onKeyup:(0,r.D2)(w.submit,["enter"]),error:f.v$.form.pass.$error,class:"full-width",autocomplete:"current-password"},null,8,["modelValue","onChange","onKeyup","error"])])),_:1}),(0,s._)("div",n,[(0,s.Wm)($,{onClick:t[5]||(t[5]=e=>g.forgottenPassword=!0),"no-caps":"",flat:"",dense:"",label:"Mot de passe oublié ?"})])])]),(0,s._)("div",null,[(0,s.Wm)(V,{modelValue:g.forgottenPassword,"onUpdate:modelValue":t[7]||(t[7]=e=>g.forgottenPassword=e),persistent:""},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{style:{"min-width":"350px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[d])),_:1}),(0,s.Wm)(y,{class:"q-pt-none"},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{dense:"",modelValue:g.form.email,"onUpdate:modelValue":t[6]||(t[6]=e=>g.form.email=e),placeholder:"Email",error:f.v$.form.email.$error,autofocus:"",onKeyup:(0,r.D2)(w.resetPassword,["enter"])},null,8,["modelValue","error","onKeyup"])])),_:1}),(0,s.Wm)(b,{align:"right"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)($,{outline:"",label:"Annuler"},null,512),[[Z]]),(0,s.Wm)($,{color:"primary",disable:g.form.email,label:"Envoyer",onClick:w.resetPassword},null,8,["disable","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,s._)("div",null,[(0,s.Wm)(V,{modelValue:g.infoOnReset,"onUpdate:modelValue":t[8]||(t[8]=e=>g.infoOnReset=e),persistent:""},{default:(0,s.w5)((()=>[(0,s.Wm)(_,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,{class:"row items-center q-pb-none rgpd"},{default:(0,s.w5)((()=>[c,(0,s.Wm)(W),(0,s.wy)((0,s.Wm)($,{icon:"close",flat:"",round:"",dense:"","absolute-right":""},null,512),[[Z]])])),_:1}),(0,s.Wm)(y,{class:"rgpd"},{default:(0,s.w5)((()=>[m])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,s._)("div",p,[(0,s.Wm)($,{color:"primary",onClick:w.submit},{default:(0,s.w5)((()=>[u])),_:1},8,["onClick"])]),(0,s._)("div",h,[(0,s.Wm)(k,{modelValue:g.clearOnLogin,"onUpdate:modelValue":t[9]||(t[9]=e=>g.clearOnLogin=e),label:"Réinitialiser"},null,8,["modelValue"]),(0,s.Wm)(C,{name:"info_outline",color:"primary",class:"iconInfoReset",onClick:t[10]||(t[10]=e=>g.infoOnReset=!0)})])],512)])),_:1})}var g=o(65850),w=o(52331),v=o(48825),q=o(58308);const $={i8:"1.10.3"};var y=o(86310);const b={inject:["$helpers","$DB"],setup(){return{v$:(0,g.ZP)(),q:(0,v.Z)()}},mounted(){this.q.loading.hide(),window.addEventListener("deviceready",this.deviceReady(),!1)},validations(){return{form:{email:{required:q.C1,email:q.Do},pass:{required:q.C1,minLength:(0,q.Ei)(6)}}}},data(){return{infoOnReset:!1,email:"",forgottenPassword:!1,clearOnLogin:!1,form:{email:"",pass:""},appVersion:{versionNumber:""},device:{manufacturer:"",model:"",platform:"",version:""},nextRoute:{path:"/categories"}}},methods:{resetPassword(){this.$v.form.email.$touch(),this.$v.form.email.$error||this.$SowellProxy.resetPassword(this.form.email).then((()=>{this.q.notify({message:"Vous recevrez un lien de récupération de mot de passe dans votre boîte email dans quelques minutes",type:"info",position:"top"}),this.forgottenPassword=!1})).catch((e=>{this.q.notify({message:"Votre adresse email n'est pas dans notre base",type:"warning",position:"top"}),this.forgottenPassword=!1}))},deviceReady(){this.q.localStorage.has("credentials")&&(this.form.email=this.q.localStorage.getItem("credentials").email,this.form.pass=this.q.localStorage.getItem("credentials").pass),this.q.platform.is.capacitor&&(this.setDevice(),this.setAppVersion())},async setDevice(){await w.A.getInfo().then((e=>{this.device={manufacturer:e.manufacturer,model:e.model,platform:e.platform,version:e.version}}))},setAppVersion(){this.appVersion={versionNumber:$.i8}},submit(){this.q.loading.show({delay:0}),this.v$.form.$touch(),this.clearOnLogin&&this.$store.dispatch("reporter/reset"),this.v$.form.$error?(this.q.notify({message:"Merci de saisir vos identifiants",type:"warning",position:"top"}),this.q.loading.hide()):((!this.q.localStorage.has("credentials")||this.q.localStorage.has("credentials")&&this.q.localStorage.getItem("credentials").email!==this.form.email)&&(this.q.localStorage.clear(),this.$DB.resetLocalDBs(this.q.platform.is.capacitor),this.$store.dispatch("reporter/reset")),this.$store.dispatch("reporter/authenticate",{credentials:{email:this.form.email,password:this.form.pass},device:this.device,appVersion:this.appVersion}).then((()=>{const e=this.$helpers.decodeToken(this.$store.getters["reporter/token"]);this.q.localStorage.set("credentials",this.form);let t=String(e.sub);if(this.q.platform.is.capacitor&&(window.plugins.OneSignal.setEmail(this.form.email),window.plugins.OneSignal.setExternalUserId(t),window.plugins.OneSignal.sendTag("sw_user_id",t)),y.Z.$emit("userConnected"),"redirect"in this.$route.query)this.$router.push(this.$route.query.redirect);else{switch(e.company_hp){case 1:e.roles.includes("checklister")&&(this.nextRoute={path:"/zones"});break;case 2:this.nextRoute={path:"/history"};break}this.$router.push(this.nextRoute)}}),(()=>{this.form.pass="",this.q.loading.hide()})))}}};var _=o(74260),V=o(24379),W=o(86115),k=o(34842),C=o(48240),P=o(24390),Z=o(10151),S=o(25589),x=o(99367),Q=o(62025),R=o(65735),E=o(24554),O=o(60677),D=o(7518),U=o.n(D);const A=(0,_.Z)(b,[["render",f]]),I=A;U()(b,"components",{QPage:V.Z,QField:W.Z,QInput:k.Z,QBtn:C.Z,QDialog:P.Z,QCard:Z.Z,QCardSection:S.Z,QCardActions:x.Z,QSpace:Q.Z,QCheckbox:R.Z,QIcon:E.Z}),U()(b,"directives",{ClosePopup:O.Z})}}]);