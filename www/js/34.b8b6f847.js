"use strict";(self["webpackChunkreporter"]=self["webpackChunkreporter"]||[]).push([[34],{72034:(e,s,t)=>{t.r(s),t.d(s,{default:()=>N});var l=t(83673),i=t(98880),n=t(62323);const d={key:1};function a(e,s,t,a,c,o){const r=(0,l.up)("q-tab"),u=(0,l.up)("q-tabs"),p=(0,l.up)("audits-list"),h=(0,l.up)("q-icon"),m=(0,l.up)("q-select"),g=(0,l.up)("q-field"),y=(0,l.up)("q-btn"),b=(0,l.up)("q-item-section"),w=(0,l.up)("q-spinner-ios"),A=(0,l.up)("q-item"),I=(0,l.up)("q-list"),k=(0,l.up)("q-page"),q=(0,l.Q2)("ripple");return(0,l.wg)(),(0,l.j4)(k,{class:"q-px-md"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(u,{modelValue:c.selectedTab,"onUpdate:modelValue":s[0]||(s[0]=e=>c.selectedTab=e),inverted:"",class:"q-pb-lg text-primary"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"myScope",icon:"person_pin_circle",label:"Mon secteur"}),(0,l.Wm)(r,{name:"other",icon:"add_circle_outline",label:"Autre"})])),_:1},8,["modelValue"]),[[i.F8,e.company.allowUnplannedAudits&&o.isChecklister()]]),"myScope"===c.selectedTab?((0,l.wg)(),(0,l.j4)(p,{key:0,zones:e.zones,loadingAudits:e.loadingAudits},null,8,["zones","loadingAudits"])):((0,l.wg)(),(0,l.iD)("div",d,[(0,l.wy)((0,l.Wm)(g,{borderless:""},{before:(0,l.w5)((()=>[(0,l.Wm)(h,{name:"store_mall_directory",color:"primary"})])),control:(0,l.w5)((()=>[(0,l.Wm)(m,{outlined:"",onInput:s[1]||(s[1]=s=>e.$refs["topZone"].$el.childNodes[2].blur()),modelValue:c.selectedAgencyId,"onUpdate:modelValue":s[2]||(s[2]=e=>c.selectedAgencyId=e),"option-value":e.value,"option-label":"label",options:o.sortList(o.$helpers.resourcesToFormOptions(c.agencies)),behavior:"menu",label:"Agence",ref:"topZone",dense:"",class:"qSelect","emit-value":"","display-value":o.$helpers.findOptionName(c.agencies,c.selectedAgencyId)},null,8,["modelValue","option-value","options","display-value"])])),_:1},512),[[i.F8,c.agencies.length>1]]),(0,l.wy)((0,l.Wm)(g,{borderless:""},{before:(0,l.w5)((()=>[(0,l.Wm)(h,{name:"location_city",color:"primary"})])),control:(0,l.w5)((()=>[(0,l.Wm)(m,{outlined:"",onInput:s[3]||(s[3]=s=>e.$refs["zone"].$el.childNodes[2].blur()),modelValue:c.selectedResidenceId,"onUpdate:modelValue":s[4]||(s[4]=e=>c.selectedResidenceId=e),"option-value":"value","option-label":"label",options:o.sortList(o.$helpers.resourcesToFormOptions(c.residences)),behavior:"menu",label:"Résidence",ref:"zone",dense:"",class:"qSelect","emit-value":"","display-value":o.$helpers.findOptionName(c.residences,c.selectedResidenceId)},null,8,["modelValue","options","display-value"])])),_:1},512),[[i.F8,c.selectedAgencyId]]),(0,l.Wm)(g,{borderless:"",class:"q-ma-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.places,(s=>(0,l.wy)(((0,l.wg)(),(0,l.j4)(A,{clickable:"",disable:e.loadingAudits,key:s.id,onClick:e=>o.loadAuditsInOtherScopes(s)},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{avatar:""},{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.j4)(y,{round:"",color:"primary",size:"15px",key:"btn"+s.id,class:"float-right"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{name:"place",size:"30px"})])),_:2},1024))])),_:2},1024),(0,l.Wm)(b,{class:"uppercase text-black"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(s.name),1)])),_:2},1024),e.loadingAudits&&s.id==c.selectedId?((0,l.wg)(),(0,l.j4)(b,{key:0,avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{class:"sw-c-loader",color:"primary",size:"sm"})])),_:1})):(0,l.kq)("",!0)])),_:2},1032,["disable","onClick"])),[[q]]))),128))])),_:1})])),_:1})]))])),_:1})}var c=t(93617);const o={key:0,class:"fullscreen column flex-center z-max text-center"},r=(0,l.Uk)(" Chargement des contrôles "),u={key:1,class:"text-center absolute-center full-width text-grey-7 q-pb-xl"},p=(0,l.Uk)(" Plus de contrôle en attente, "),h=(0,l._)("br",null,null,-1),m=(0,l.Uk)("bon boulot ! "),g=[p,h,m],y=["onClick"],b={class:"col-xs-2 col-sm-3 col-md-4 col-lg-5"},w={class:"col-xs-10 col-sm-9 col-md-8 col-lg-7 q-pl-sm"},A={class:"uppercase"},I={class:"q-caption"},k=(0,l._)("br",null,null,-1);function q(e,s,t,d,a,c){const p=(0,l.up)("q-spinner-dots"),h=(0,l.up)("q-icon"),m=(0,l.up)("q-btn"),q=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(q,{class:"q-px-md"},{default:(0,l.w5)((()=>[t.loadingAudits&&0===t.zones.length?((0,l.wg)(),(0,l.iD)("div",o,[(0,l._)("h5",null,[r,(0,l.Wm)(p,{class:"sw-c-loader",size:"50px"})])])):(0,l.kq)("",!0),t.zones.length?(0,l.kq)("",!0):(0,l.wy)(((0,l.wg)(),(0,l.iD)("h5",u,g,512)),[[i.F8,!t.loadingAudits]]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.zones,(s=>(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",{key:s.id},[((0,l.wg)(),(0,l.iD)("div",{class:"row q-py-md",key:s.id,onClick:t=>e.$router.push(`/zones/${s.id}`)},[(0,l._)("div",b,[((0,l.wg)(),(0,l.j4)(m,{round:"",color:"primary",size:"15px",key:"btn"+s.id,class:"float-right"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{name:"location_city",size:"30px"})])),_:2},1024))]),(0,l._)("div",w,[(0,l._)("span",A,(0,n.zw)(s.name),1),(0,l._)("span",I,[k,(0,l._)("i",null,"( "+(0,n.zw)(c.displayNbControls(s.auditsCount))+")",1)])])],8,y))])),[[i.F8,!t.loadingAudits]]))),128))])),_:1})}const $={name:"AuditsList",props:{zones:Array,loadingAudits:Boolean},data(){return{}},methods:{displayNbControls(e){return e>1?e+" contrôles":e+" contrôle"}}};var f=t(74260),_=t(24379),v=t(34765),S=t(48240),z=t(24554),x=t(7518),Z=t.n(x);const C=(0,f.Z)($,[["render",q]]),R=C;Z()($,"components",{QPage:_.Z,QSpinnerDots:v.Z,QBtn:S.Z,QIcon:z.Z});const W={inject:["$helpers"],components:{AuditsList:R},data(){return{selectedTab:"myScope",selectedId:"",agencies:[],residences:[],places:[],selectedAgencyId:null,selectedResidenceId:null,selectedPlaceId:null}},mounted(){this.$q.loading.hide();let e="";e=this.isChecklister()?this.$route.query.tab?this.$route.query.tab:"myScope":"other",this.selectedTab=e},watch:{selectedTab(){this.resetAuditsInOtherScopes(),"myScope"===this.selectedTab?this.agencies=this.userAgencies:(this.$q.loading.show(),this.$SowellProxy.loadCompanyAgencies(this.company.id).then((e=>{this.agencies=e.data.map((e=>({id:e.id,name:e.name}))),this.$q.loading.hide()})));const e=`${this.$route.path}?tab=${this.selectedTab}`;e!==this.$route.fullPath&&this.$router.push(e)},agencies(){this.agencies&&1===this.agencies.length&&this.selectAgency(this.agencies[0].id)},residences(){1===this.residences.length&&this.selectResidence(this.residences[0].id)},selectedAgencyId(e){this.selectAgency(e)},selectedResidenceId(e){this.selectResidence(e)}},computed:{...(0,c.Se)({company:"company/attributes",zones:"audits/reduceResidences",loadingAudits:"audits/isControleChanged",reducedAudits:"audits/byPlace"})},methods:{isChecklister(){return this.$helpers.decodeToken(this.$store.getters["reporter/token"]).roles.includes("checklister")},sortList(e){return e.sort(((e,s)=>null===e.label||e.label.toString().localeCompare(s.label.toString(),"fr",{ignorePunctuation:!0})))},selectAgency(e){this.resetAuditsInOtherScopes(["agencies"]),null!==e&&void 0!==e&&(this.selectedAgencyId=e,this.$q.loading.show(),this.residences=[],this.$SowellProxy.loadAgencyResidences(this.selectedAgencyId,!0).then((e=>{e.data.forEach((e=>{!0===e["has-audits"]&&this.residences.push({id:e.id,name:e.name})})),this.$q.loading.hide()})))},selectResidence(e){this.resetAuditsInOtherScopes(["agencies","selectedAgencyId","residences"]),null!==e&&void 0!==e&&(this.selectedResidenceId=e,this.$q.loading.show(),this.places=[],this.$SowellProxy.loadResidencePlaces(e,!0).then((e=>{e.data.map((e=>{!0===e["has-audits"]&&this.places.push({id:+e.id,name:e.name})})),this.$q.loading.hide()})))},resetAuditsInOtherScopes(e=[]){switch(e){case!e.includes("agencies"):this.agencies=[];break;case!e.includes("residences"):this.residences=[];break;case!e.includes("selectedAgencyId"):this.selectedAgencyId=null;break;case!e.includes("selectedResidenceId"):this.selectedResidenceId=null;break}},loadAuditsInOtherScopes(e){this.selectedId=e.id,this.$store.dispatch("audits/loadAuditsInOtherScopes",e).then((()=>{this.$router.push(`/zones/${this.selectedResidenceId}/places/${e.id}?tab=${this.selectedTab}`)}))}}};var Q=t(57547),T=t(58408),O=t(86115),P=t(72448),V=t(27011),j=t(83414),D=t(52035),F=t(18506),U=t(46489);const L=(0,f.Z)(W,[["render",a],["__scopeId","data-v-385e54a5"]]),N=L;Z()(W,"components",{QPage:_.Z,QTabs:Q.Z,QTab:T.Z,QField:O.Z,QIcon:z.Z,QSelect:P.Z,QList:V.Z,QItem:j.Z,QItemSection:D.Z,QBtn:S.Z,QSpinnerIos:F.Z}),Z()(W,"directives",{Ripple:U.Z})}}]);